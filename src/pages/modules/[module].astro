---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import { MODULES } from '../../lib/curriculum';
import { getAllLessons } from '../../lib/lessons';

export async function getStaticPaths() {
  return MODULES.map(mod => ({
    params: { module: mod.slug },
    props: { mod },
  }));
}

const { mod } = Astro.props;
const allLessons = await getAllLessons();
const moduleLessons = allLessons.filter(l => l.data.module === mod.id);
---

<BaseLayout title={mod.name}>
  <Header />
  <main class="max-w-3xl mx-auto px-4 sm:px-6 py-12">
    <!-- Back -->
    <a href={`${import.meta.env.BASE_URL}modules`} class="inline-flex items-center gap-1 text-xs text-slate-500 hover:text-slate-300 transition-colors mb-8">
      ← All Modules
    </a>

    <!-- Header -->
    <div class="flex items-start gap-4 mb-8">
      <span class="text-4xl">{mod.icon}</span>
      <div>
        <div class="flex items-center gap-2 mb-1">
          <span class="text-xs px-2 py-0.5 rounded-full font-medium"
            style={`background-color: ${mod.color}22; color: ${mod.color}`}
          >
            Module {mod.id}
          </span>
          <span class="text-xs text-slate-600">
            {mod.phase === 'csharp' ? 'Phase 1: C# Language' : 'Phase 2: .NET & ASP.NET'}
          </span>
        </div>
        <h1 class="text-2xl font-bold text-white">{mod.name}</h1>
        <p class="text-slate-400 text-sm mt-1">Weeks {mod.weeks[0]}–{mod.weeks[1]} · Days {mod.days[0]}–{mod.days[1]} · {moduleLessons.length} lessons</p>
      </div>
    </div>

    <p class="text-slate-400 mb-8">{mod.description}</p>

    <!-- Lesson list -->
    <div class="space-y-2">
      {moduleLessons.map(lesson => {
        const dayStr = String(lesson.data.day).padStart(3, '0');
        return (
          <a
            href={`${import.meta.env.BASE_URL}lessons/day-${dayStr}`}
            class="flex items-center gap-4 p-4 rounded-xl border border-slate-800 hover:border-slate-600 hover:bg-slate-800/30 transition-all group"
          >
            <div class="w-8 h-8 rounded-lg bg-slate-800 flex items-center justify-center text-xs font-mono font-bold text-slate-400 group-hover:text-white transition-colors shrink-0">
              {lesson.data.day}
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-slate-300 group-hover:text-white transition-colors">
                {lesson.data.title}
                {lesson.data.isProject && (
                  <span class="ml-2 text-xs px-1.5 py-0.5 rounded bg-purple-900/50 text-purple-400">
                    {lesson.data.projectType === 'capstone' ? 'Capstone' : 'Project'}
                  </span>
                )}
              </p>
              {lesson.data.dartConcept && (
                <p class="text-xs text-slate-600 mt-0.5">
                  Dart: {lesson.data.dartConcept} → {lesson.data.csharpConcept}
                </p>
              )}
            </div>
            <span class="text-xs text-slate-600 shrink-0">Week {Math.ceil(lesson.data.day / 5)}</span>
          </a>
        );
      })}
    </div>
  </main>
</BaseLayout>
