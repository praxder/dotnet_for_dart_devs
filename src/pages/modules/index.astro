---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import { MODULES } from '../../lib/curriculum';
import { getAllLessons } from '../../lib/lessons';

const allLessons = await getAllLessons();
---

<BaseLayout title="All Modules">
  <Header />
  <main class="max-w-4xl mx-auto px-4 sm:px-6 py-12">
    <h1 class="text-3xl font-bold text-white mb-2">Course Modules</h1>
    <p class="text-slate-400 mb-10">10 modules across 26 weeks — from C# basics to production ASP.NET APIs.</p>

    <!-- Phase 1 -->
    <section class="mb-10">
      <h2 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-4">
        Phase 1 · C# Language (Weeks 1–13)
      </h2>
      <div class="grid gap-4 sm:grid-cols-2">
        {MODULES.filter(m => m.phase === 'csharp').map(mod => {
          const lessonCount = allLessons.filter(l => l.data.module === mod.id).length;
          return (
            <a
              href={`/modules/${mod.slug}`}
              class="group p-5 rounded-2xl border border-slate-800 hover:border-slate-600 bg-slate-900/50 hover:bg-slate-800/50 transition-all"
            >
              <div class="flex items-start gap-3">
                <span class="text-2xl">{mod.icon}</span>
                <div class="flex-1 min-w-0">
                  <h3 class="font-semibold text-white group-hover:text-indigo-300 transition-colors text-sm leading-snug">{mod.name}</h3>
                  <p class="text-xs text-slate-500 mt-0.5">Weeks {mod.weeks[0]}–{mod.weeks[1]} · Days {mod.days[0]}–{mod.days[1]}</p>
                </div>
              </div>
              <p class="text-xs text-slate-500 mt-3 leading-relaxed">{mod.description}</p>
              <div class="mt-3 pt-3 border-t border-slate-800 flex items-center justify-between">
                <span class="text-xs text-slate-600">{lessonCount} lessons</span>
                <span class="text-xs text-indigo-400 group-hover:text-indigo-300 transition-colors">Explore →</span>
              </div>
            </a>
          );
        })}
      </div>
    </section>

    <!-- Phase 2 -->
    <section>
      <h2 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-4">
        Phase 2 · .NET &amp; ASP.NET (Weeks 14–26)
      </h2>
      <div class="grid gap-4 sm:grid-cols-2">
        {MODULES.filter(m => m.phase === 'dotnet').map(mod => {
          const lessonCount = allLessons.filter(l => l.data.module === mod.id).length;
          return (
            <a
              href={`/modules/${mod.slug}`}
              class="group p-5 rounded-2xl border border-slate-800 hover:border-slate-600 bg-slate-900/50 hover:bg-slate-800/50 transition-all"
            >
              <div class="flex items-start gap-3">
                <span class="text-2xl">{mod.icon}</span>
                <div class="flex-1 min-w-0">
                  <h3 class="font-semibold text-white group-hover:text-sky-300 transition-colors text-sm leading-snug">{mod.name}</h3>
                  <p class="text-xs text-slate-500 mt-0.5">Weeks {mod.weeks[0]}–{mod.weeks[1]} · Days {mod.days[0]}–{mod.days[1]}</p>
                </div>
              </div>
              <p class="text-xs text-slate-500 mt-3 leading-relaxed">{mod.description}</p>
              <div class="mt-3 pt-3 border-t border-slate-800 flex items-center justify-between">
                <span class="text-xs text-slate-600">{lessonCount} lessons</span>
                <span class="text-xs text-sky-400 group-hover:text-sky-300 transition-colors">Explore →</span>
              </div>
            </a>
          );
        })}
      </div>
    </section>
  </main>
</BaseLayout>
